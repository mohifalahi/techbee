<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link rel="stylesheet" href="{%static 'aseests/bootstrap/css/bootstrap-grid.min.css' %}">
    <link rel="stylesheet" href="{%static 'aseests/bootstrap/css/bootstrap-reboot.min.css' %}">
    <link rel="stylesheet" href="{%static 'aseests/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{%static 'style/master.css' %}">
    <script src="{%static 'js/javascript.js' %}"></script>
    <script src="{%static 'js/jquery-2.2.4.min.js' %}"></script>
    <script src="{%static 'aseests/jquery/jquery.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script async="" src="{%static 'js/Line%20Chart_files/analytics.js' %}"></script>
    <script src="{%static 'js/Line%20Chart_files/chart.js' %}"></script>
    <script src="{%static 'js/Line%20Chart_files/utils.js' %}"></script>
    <title>خانه هوشمند تک بی</title>
</head>

<body>
    <header>
        <div class="top-header d-flex justify-content-center align-items-center">
            <div class="hamber-icon">
                <span class="hamber-icon_top"></span>
                <span class="hamber-icon_middle"></span>
                <span class="hamber-icon_bottom"></span>
            </div>
            <figure class="logo mb-0">
                <img src="{%static 'images/logo.png' %}" class="img-fluid" alt="">
            </figure>
        </div>
        <div class="slider-menu">
            <div class="login d-flex justify-content-center align-items-center">
                <a href="#">
                    <div class="text-white d-flex flex-column align-items-center">
                        <!-- <FontAwesomeIcon class="mb-3" icon={faUser} size="5x" /> -->
                        <div class="user-icon">
                                <i class="fas fa-user"></i>
                              </div>
                        <span>خوش آمدید</span>
                    </div>
                </a>
            </div>

            <nav class="navigation-menu_mobile">
                <ul>
                    <li>
                        <a href="{% url 'dashboard' %}">داشبورد</a>
                    </li>
                    <li>
                        <a href="{% url 'devices' %}">دستگاه‌ها</a>
                    </li>
                    <li>
                        <a href="{% url 'charts' %}">نمودارها</a>
                    </li>
                </ul>
            </nav>
        </div>

    </header>
    <main>
        <div id="fake"></div>
        <div id="showAllDevice" class="mb-4 py-3">
            <div class="container">
                <div class="row">
                   
                    {% for place in places.all %}
                        <!-- {% if place.device_type == 'عملگر' %} -->
                        <div id="updated_devices" class="col-12 col-md-6 col-lg-4 col-lg-3">
                            <div class="card-device">
                                <div class="card-icon">
                                    <i id="icon" class='{{place.icon_class}}'></i>
                                </div>
                                <div class="detail">
                                    <span class="name">
                                        {{ place.place }}
                                    </span>
                                    >
                                    <span class="type">
                                        {{ place.device }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <!-- {% endif %} -->
                    {% endfor %}
                    
                </div>
            </div>
        </div>
        <div id="Newdevice">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <button type="button" class="btn btn-new-device mb-2" data-toggle="collapse" data-target="#demo">
                            <span class="pl-2">
                                <i class="fa fa-plus" aria-hidden="true"></i>
                            </span>
                           
                            افزودن دستگاه 
                        </button>
                        <div id="demo" class="collapse">
                            <form id="form_box" class="form-new-device p-2" action="{% url 'devices' %}" method='POST'>
                                {% csrf_token %}
                                <div class="form-group input-group">
                                  <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                  </div>
                                  <input id="place" type="text" name="place" class="form-control" placeholder="مکان" required>
                                </div>
                                <div class="form-group input-group">
                                  <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-tag"></i></span>
                                  </div>
                                  <select class="custom-select type-device" id="device_type" name="device_type">
                                    <option selected>نوع دستگاه</option>
                                    <option value="حسگر">حسگر</option>
                                    <option value="عملگر">عملگر</option>
                                  </select>
                                </div>
                                <div class="form-group input-group">
                                  <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-dice-d6"></i></span>
                                  </div>
                                  <input id="device" type="text" name="device" class="form-control" placeholder="دستگاه" required>
                                </div>
                                <div class="form-group input-group">
                                    <div class="input-group-prepend">
                                      <span class="input-group-text"><i class="fas fa-fingerprint"></i></span>
                                    </div>
                                    <input id="unique_id" type="text" name="unique_id" class="form-control" placeholder="شناسه" required>
                                  </div>

                                  <div class="form-group input-group">
                                    <div class="input-group-prepend">
                                      <span class="input-group-text"><i class="fas fa-info-circle"></i></span>
                                    </div>
                                    <select class="custom-select type-device" id="icon_class" name="icon_class" required>
                                        <option selected>آیکون</option>
                                        <option value="fas fa-thermometer-half">حسگر دما</option>
                                        <option value="fas fa-tint">حسگر رطوبت</option>
                                        <option value="fas fa-wind">حسگر کیفیت هوا</option>
                                        <option value="fas fa-bolt">حسگر توان</option>
                                        <option value="far fa-lightbulb">چراغ</option>
                                      </select>
                                  </div>
                                <div class="form-group">
                                  <input type="submit" name="submit" id="submit" class="btn btn-primary btn-block" value="افزودن">
                                </div>
                             </form>
                            </div>
                          </div>
                    </div>
                </div>
            </div>


        </div>
    </main>
    <script src="{%static 'aseests/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{%static 'aseests/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{%static 'aseests/popper/popper.js' %}"></script>
</body>

<script>
    $(document).on('submit', '#form_box', function(h){
    h.preventDefault();
    console.log("Form submitted.");
    // AJAX form submission function
    $.ajax({
      type: 'POST',
      url: "{% url 'devices' %}",
      data:{
        place: $('#place').val(),
        device_type: $('#device_type').val(),
        device: $('#device').val(),
        unique_id: $('#unique_id').val(),
        icon_class: $('#icon_class').val(),
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
      },
      // handle a success response
      success:function(){
        console.log("Data added.");
      }
    });
  });
  $('#updated_devices').load(document.{% url 'devices' %} +  ' #updated_devices');
</script>
</html>